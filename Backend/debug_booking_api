<?php
// debug_booking_api.php
include "Backend/db.php";
session_start();

echo "<h2>üîç PGCore Debug Tool</h2>";
echo "<pre>";

// 1. Check Session
echo "\n1. SESSION DATA:\n";
print_r($_SESSION);

if(!isset($_SESSION['logged_in']) || $_SESSION['logged_in'] !== true){
    echo "‚ùå User NOT logged in\n";
    exit;
}

$user_id = $_SESSION['user_id'];
echo "‚úÖ User ID: " . $user_id . "\n";

// 2. Check Database Connection
echo "\n2. DATABASE CONNECTION:\n";
if($conn){
    echo "‚úÖ Connected successfully\n";
} else {
    echo "‚ùå Connection failed: " . mysqli_connect_error() . "\n";
    exit;
}

// 3. Check Users Table
echo "\n3. USERS TABLE:\n";
$sql = "SELECT id, fullname, email, phone FROM users WHERE id = $user_id";
$result = mysqli_query($conn, $sql);
if(mysqli_num_rows($result) > 0){
    $user = mysqli_fetch_assoc($result);
    echo "‚úÖ User found:\n";
    print_r($user);
} else {
    echo "‚ùå User NOT found in database\n";
}

// 4. Check Bookings Table Structure
echo "\n4. BOOKINGS TABLE STRUCTURE:\n";
$sql = "DESCRIBE bookings";
$result = mysqli_query($conn, $sql);
if($result){
    echo "‚úÖ Bookings table columns:\n";
    while($row = mysqli_fetch_assoc($result)){
        echo "   - " . $row['Field'] . " (" . $row['Type'] . ")\n";
    }
} else {
    echo "‚ùå Error: " . mysqli_error($conn) . "\n";
}

// 5. Check Bookings for this user
echo "\n5. BOOKINGS FOR USER ID $user_id:\n";
$sql = "SELECT * FROM bookings WHERE user_id = $user_id";
$result = mysqli_query($conn, $sql);
if(mysqli_num_rows($result) > 0){
    echo "‚úÖ Bookings found:\n";
    while($row = mysqli_fetch_assoc($result)){
        print_r($row);
    }
} else {
    echo "‚ùå No bookings found\n";
    echo "   SQL Error: " . mysqli_error($conn) . "\n";
}

// 6. Check Rooms Table
echo "\n6. ROOMS TABLE:\n";
$sql = "SELECT room_id, room_number, room_type FROM rooms LIMIT 5";
$result = mysqli_query($conn, $sql);
if(mysqli_num_rows($result) > 0){
    echo "‚úÖ Rooms found:\n";
    while($row = mysqli_fetch_assoc($result)){
        echo "   Room ID: " . $row['room_id'] . " - " . $row['room_number'] . " - " . $row['room_type'] . "\n";
    }
} else {
    echo "‚ùå No rooms found\n";
}

echo "\n</pre>";
mysqli_close($conn);
?>